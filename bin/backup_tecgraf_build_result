#!/usr/bin/env bash

if [ "$#" -eq 0 ]; then
   echo "usage: $(basename $0): {im|ftgl|cd|iup}"
   exit 1
fi

pkg=$1
dir="$HOME/Nextcloud/tecgraf/repos/$pkg"
if [ ! -d "$dir" ]; then
   echo "ERROR: directory not found ${dir}"
   exit 1
fi

cd "$dir"
if [ -f ./tec_uname ]; then
    . ./tec_uname
    ComputeTecUname
    ComputeSystemPaths
    ComputeLuaVersion
else
    TEC_UNAME=$(ls lib)
fi
# debug_tec_uname.sh
baselib="./lib/$TEC_UNAME"
# echo $baselib
# env | grep USE_ | sort
basename=""
if [[ ! -z  "$USE_MOTIF"  ]]; then
    basename="${pkg}_motif"
fi
if [[ ! -z  "$USE_GTK"  ]]; then
    basename="${pkg}_gtk"
fi
echo $basename
if [[  -z "$basename" ]]; then
    echo "ERROR: invalid target"
    exit 1
fi
echo $baselib
tar -czvf /tmp/$basename.gz  -C $baselib .
mkdir -p _so/$basename
cd _so/$basename
tar -zxvf /tmp/$basename.gz
exit 0
